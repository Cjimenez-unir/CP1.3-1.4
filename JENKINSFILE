pipeline {
    agent any

    environment {
        PYTHONPATH = "$WORKSPACE"
    }

    stages {
        stage('Get Code') {
            steps {
                git branch: 'develop',
                    url: 'https://github.com/Cjimenez-unir/CP1.3-1.4.git'
            }
        }

        stage('Static Test') {
            steps {
                // Ejecutar flake8
                sh '''
                    echo "=== An치lisis de c칩digo con Flake8 ==="
                    flake8 --exit-zero --format=pylint  . >flake8.out
                '''
                recordIssues tools: [flake8(name: 'Flake8', pattern: 'flake8.out')]

                // Ejecutar bandit
                sh '''
                    echo "=== An치lisis de c칩digo con Bandit ==="
                    bandit -r src/ -f custom -o bandit.out -ll --msg-template "{abspath}:{line}: [{test_id}] {msg}" || exit 0
                '''
                recordIssues tools: [pyLint(name: 'Bandit', pattern: 'bandit.out')]
            }
        }
    }
}